---
title: "GEE modeling results"
author: "Luke W. Johnston"
date: "`r Sys.Date()`"
output: 
    rmarkdown::html_vignette:
        toc: true
vignette: >
  %\VignetteIndexEntry{GEE modeling results}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Setup

```{r setup, message=FALSE}
devtools::load_all()
library(dplyr)
```

# Unadjusted (with MonthsFromBaseline)
```{r unadj, cache=TRUE}
m <- analyze_gee(covars = 'MonthsFromBaseline')
m <- filter(m, p.value <= 0.05) 
nrow(m)
table_gee_main(m)
```

# Unadjusted (with VN)
```{r unadj, cache=TRUE}
m <- analyze_gee(covars = 'VN')
m <- filter(m, p.value <= 0.05) 
nrow(m)
table_gee_main(m)
```

# Adjusted
```{r adj, cache=TRUE}
m <- analyze_gee()
m <- filter(m, p.value <= 0.05) 
nrow(m)
table_gee_main(m)
```

## Adjusting for `M4` in qic.html

```{r}
m <- analyze_gee(covars = c('Waist', 'BaseAge', 'Ethnicity', 
                            'Sex', 'ALT', 'MET', 'AlcoholPerWk'))
m <- filter(m, p.value <= 0.05) 
nrow(m)
table_gee_main(m)
```

# Interactions

## Time (Unadjusted)
```{r int_time, cache=TRUE}
m <- analyze_gee(covar = 'MonthsFromBaseline', intvar = 'MonthsFromBaseline')
m <- filter(m, p.value <= 0.05) 
nrow(m)

m %>% 
    select(Yterms, Xterms, term, estimate) %>% 
    pander::pander()
```

## Time
```{r int_time, cache=TRUE}
m <- analyze_gee(intvar = 'MonthsFromBaseline')
m <- filter(m, p.value <= 0.05) 
nrow(m)

m %>% 
    select(Yterms, Xterms, term, estimate) %>% 
    pander::pander()
```

## Sex
```{r int_sex, cache=TRUE}
m <- analyze_gee(intvar = 'Sex')
m <- filter(m, p.value <= 0.05) 
nrow(m)

m %>% 
    select(Yterms, Xterms, term, estimate) %>% 
    pander::pander()
```

## Ethnicity
```{r int_ethnicity, cache=TRUE}
m <- analyze_gee(intvar = 'BiEthnicity')
m <- filter(m, p.value <= 0.05) 
nrow(m)

m %>% 
    select(Yterms, Xterms, term, estimate) %>% 
    pander::pander()
```

# Stratified analysis (Sex)

## Female
```{r strat_sex_female, cache=TRUE}
data_female <- project_data %>% 
    filter(Sex == 'Female')
m <- analyze_gee(data = data_female, covar = covariates[-5])
m <- filter(m, p.value <= 0.05) 
nrow(m)

table_gee_main(m)
```

## Male
```{r strat_sex_male, cache=TRUE}
data_male <- project_data %>% 
    filter(Sex == 'Male')
m <- analyze_gee(data = data_male, covar = covariates[-5])
m <- filter(m, p.value <= 0.05) 
nrow(m)

table_gee_main(m)
```
